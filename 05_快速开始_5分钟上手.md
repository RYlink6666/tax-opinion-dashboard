# å¿«é€Ÿå¼€å§‹ â€” 5åˆ†é’Ÿä¸Šæ‰‹æŒ‡å—

## ç¬¬0æ­¥ï¼šç¡®è®¤ä½ æœ‰ä»€ä¹ˆï¼ˆ30ç§’ï¼‰

```
âœ… æ™ºè°±æ¸…è¨€è´¦æˆ· + 2000ä¸‡tokenï¼ˆå·²æœ‰ï¼‰
âœ… 5000æ¡èˆ†è®ºæ•°æ®
âœ… Pythonç¯å¢ƒï¼ˆå·²è£…ï¼‰
? æ™ºè°±APIå¯†é’¥ï¼ˆéœ€è¦å¤åˆ¶ï¼‰
```

---

## ç¬¬1æ­¥ï¼šè·å– API å¯†é’¥ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
1. æ‰“å¼€æµè§ˆå™¨ï¼šhttps://www.bigmodel.cn/console/overview

2. ç™»å½•ä½ çš„è´¦æˆ·ï¼ˆå·²æ³¨å†Œï¼‰

3. å·¦ä¾§èœå• â†’ "APIå¯†é’¥"

4. ç‚¹å‡»"æ–°å¢å¯†é’¥"

5. å¤åˆ¶æ•´ä¸ªå¯†é’¥å­—ç¬¦ä¸²ï¼ˆé•¿è¿™æ ·ï¼šsk-xxxxxxxx...ï¼‰

6. ä¿å­˜åˆ°è®°äº‹æœ¬ï¼ˆå¾…ç”¨ï¼‰
```

**éªŒè¯**ï¼šä½ ç°åœ¨æœ‰ä¸€ä¸ªåƒè¿™æ ·çš„å¯†é’¥ï¼š`sk-abc123def456...`

---

## ç¬¬2æ­¥ï¼šåˆ›å»ºé¡¹ç›®æ–‡ä»¶ï¼ˆ2åˆ†é’Ÿï¼‰

### 2.1 æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹

```bash
# Windows ç”¨æˆ·ï¼šåœ¨ä»»ä½•ä½ç½®å³é”® â†’ æ–°å»ºæ–‡ä»¶å¤¹ â†’ å‘½åä¸º "opinion_analysis"
# Mac/Linux ç”¨æˆ·ï¼š
mkdir opinion_analysis
cd opinion_analysis
```

### 2.2 åˆ›å»ºä¸‰ä¸ª Python æ–‡ä»¶

**æ–‡ä»¶1ï¼š.env**
```
ZHIPU_API_KEY=sk-ä½ çš„å¯†é’¥
```

**æ–‡ä»¶2ï¼šconfig.py**
```python
import os
from dotenv import load_dotenv

load_dotenv()

ZHIPU_API_KEY = os.getenv('ZHIPU_API_KEY')
ZHIPU_MODEL = "glm-4-flash"

INPUT_FILE = "opinions_clean_5000.txt"
OUTPUT_RESULT_FILE = "analysis_results_5000.json"
OUTPUT_EXCEL_FILE = "opinion_analysis_5000_for_paper.xlsx"
```

**æ–‡ä»¶3ï¼šmain.py**
```python
from zhipu_ai.client import ZhipuAI
import json
import time
from config import ZHIPU_API_KEY, ZHIPU_MODEL, INPUT_FILE, OUTPUT_RESULT_FILE

# åˆå§‹åŒ–
client = ZhipuAI(api_key=ZHIPU_API_KEY)

# Promptï¼ˆå®Œæ•´ç‰ˆè§04æ–‡æ¡£ï¼‰
SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è·¨å¢ƒç”µå•†ç¨æ”¶èˆ†è®ºåˆ†æç³»ç»Ÿ...
[å®Œæ•´promptè§04æ–‡ä»¶çš„ç¬¬äºŒéƒ¨åˆ†]
"""

def analyze_opinion(opinion_text):
    """åˆ†æå•æ¡èˆ†è®º"""
    
    response = client.chat.completions.create(
        model=ZHIPU_MODEL,
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": f"åˆ†æèˆ†è®ºï¼š{opinion_text}"}
        ],
        temperature=0.3,
        top_p=0.8,
    )
    
    result_text = response.choices[0].message.content
    
    # è§£æJSON
    import json
    try:
        return json.loads(result_text)
    except:
        # å°è¯•ä»æ–‡æœ¬ä¸­æå–JSON
        import re
        json_match = re.search(r'\{.*\}', result_text, re.DOTALL)
        if json_match:
            return json.loads(json_match.group())
        return {"error": "JSONè§£æå¤±è´¥"}

# ä¸»ç¨‹åº
if __name__ == "__main__":
    # è¯»å–èˆ†è®º
    with open(INPUT_FILE, 'r', encoding='utf-8') as f:
        opinions = [line.strip() for line in f.readlines()]
    
    print(f"å¼€å§‹å¤„ç† {len(opinions)} æ¡èˆ†è®º...")
    
    results = []
    for i, opinion in enumerate(opinions):
        print(f"[{i+1}/{len(opinions)}]", end='\r')
        
        result = analyze_opinion(opinion)
        result['source_text'] = opinion
        results.append(result)
        
        # æ¯10æ¡åå»¶è¿Ÿ
        if (i + 1) % 10 == 0:
            time.sleep(1)
    
    # ä¿å­˜ç»“æœ
    with open(OUTPUT_RESULT_FILE, 'w', encoding='utf-8') as f:
        json.dump({
            "total": len(results),
            "results": results
        }, f, ensure_ascii=False, indent=2)
    
    print(f"\nâœ… å®Œæˆï¼ç»“æœä¿å­˜åˆ° {OUTPUT_RESULT_FILE}")
```

---

## ç¬¬3æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# æ‰“å¼€å‘½ä»¤è¡Œï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡Œï¼š
pip install zhipu-ai pandas openpyxl python-dotenv

# éªŒè¯ï¼š
python -c "import zhipu_ai; print('âœ… OK')"
```

---

## ç¬¬4æ­¥ï¼šå‡†å¤‡æ•°æ®ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# å°†ä½ çš„5000æ¡èˆ†è®ºæ•°æ®ä¿å­˜ä¸ºï¼š
# opinion_analysis/opinions_clean_5000.txt

# æ ¼å¼ï¼šæ¯è¡Œä¸€æ¡èˆ†è®ºï¼ˆUTF-8ç¼–ç ï¼‰
# ç¤ºä¾‹ï¼š
9610å¤‡æ¡ˆ3ä¸ªæœˆäº†è¿˜æ²¡åŠ¨é™ï¼ŒçœŸçš„å¾ˆç„¦è™‘ã€‚
å°è§„æ¨¡çº³ç¨äººçš„3%æ”¿ç­–å¯¹å–å®¶å¤ªå‹å¥½äº†ã€‚
é¦™æ¸¯å…¬å¸æˆ˜ç•¥å†³ç­–éƒ½åœ¨å›½å†…...
...
```

---

## ç¬¬5æ­¥ï¼šè¿è¡Œï¼ˆä¸åˆ°1åˆ†é’Ÿï¼‰

```bash
# åœ¨é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡Œï¼š
python main.py

# çœ‹åˆ°è¿™æ ·çš„è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
# [1/5000]
# [2/5000]
# ...
# âœ… å®Œæˆï¼ç»“æœä¿å­˜åˆ° analysis_results_5000.json
```

**ç­‰å¾…æ—¶é—´**ï¼š
- 100æ¡ï¼š2åˆ†é’Ÿ
- 5000æ¡ï¼š90åˆ†é’Ÿï¼ˆåå°è‡ªåŠ¨è¿è¡Œï¼Œä½ å¯ä»¥å»åšåˆ«çš„ï¼‰

---

## å®Œæˆ âœ…

ä½ ç°åœ¨æœ‰ï¼š
- `analysis_results_5000.json` â€” ç»“æ„åŒ–åˆ†æç»“æœ
- å¯ä»¥å¯¼å‡ºä¸º Excel æˆ–ç›´æ¥ç”¨äºè®ºæ–‡

---

## å¦‚æœå‡ºé”™ï¼Ÿ

| é”™è¯¯ | è§£å†³ |
|-----|------|
| ModuleNotFoundError | é‡æ–°è¿è¡Œ `pip install zhipu-ai pandas` |
| ZHIPU_API_KEY is None | æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½• |
| 401 Unauthorized | APIå¯†é’¥å¤åˆ¶é”™äº†ï¼Œé‡æ–°è·å– |
| èˆ†è®ºæ•°æ®æ‰¾ä¸åˆ° | ç¡®ä¿ opinions_clean_5000.txt åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ |

---

## ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œmain.pyå®Œæˆå…¨é‡åˆ†æ
2. å¯¼å‡ºExcelï¼ˆè§04æ–‡æ¡£ï¼‰
3. é›†æˆåˆ°è®ºæ–‡Part B

å°±è¿™ä¹ˆç®€å•ã€‚ğŸ‰
